"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.BaseWalletMultiButton = BaseWalletMultiButton;
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = require("react");
const base_1 = require("./base/index.cjs");
const BaseWalletConnectionButton_1 = require("./BaseWalletConnectionButton.cjs");
const useWalletModal_1 = require("./useWalletModal.cjs");
const cssVariables_1 = require("./utils/cssVariables.cjs");
function BaseWalletMultiButton({ children, labels, height, primaryColor, radius, bgColor, textColor, hoverBgColor, dropdownBgColor, dropdownTextColor, dropdownHoverBgColor, ...props }) {
    const { setVisible: setModalVisible } = (0, useWalletModal_1.useWalletModal)();
    const { buttonState, onConnect, onDisconnect, publicKey, walletIcon, walletName } = (0, base_1.useWalletMultiButton)({
        onSelectWallet() {
            setModalVisible(true);
        },
    });
    const [copied, setCopied] = (0, react_1.useState)(false);
    const [menuOpen, setMenuOpen] = (0, react_1.useState)(false);
    const ref = (0, react_1.useRef)(null);
    (0, react_1.useEffect)(() => {
        const cssVars = (0, cssVariables_1.createWalletCSSVariables)({
            height,
            primaryColor,
            radius,
            buttonBgColor: bgColor,
            buttonTextColor: textColor,
            buttonHoverBgColor: hoverBgColor,
            dropdownBgColor,
            dropdownTextColor,
            dropdownHoverBgColor,
        });
        Object.entries(cssVars).forEach(([key, value]) => {
            if (value) {
                document.documentElement.style.setProperty(key, value);
            }
        });
        return () => {
            Object.keys(cssVars).forEach((key) => {
                document.documentElement.style.removeProperty(key);
            });
        };
    }, [primaryColor, radius, bgColor, textColor, hoverBgColor, dropdownBgColor, dropdownTextColor, dropdownHoverBgColor]);
    (0, react_1.useEffect)(() => {
        const listener = (event) => {
            const node = ref.current;
            if (!node || node.contains(event.target))
                return;
            setMenuOpen(false);
        };
        document.addEventListener('mousedown', listener);
        document.addEventListener('touchstart', listener);
        return () => {
            document.removeEventListener('mousedown', listener);
            document.removeEventListener('touchstart', listener);
        };
    }, []);
    const content = (0, react_1.useMemo)(() => {
        if (children) {
            return children;
        }
        else if (publicKey) {
            const base58 = publicKey.toBase58();
            return `${base58.slice(0, 4)}..${base58.slice(-4)}`;
        }
        else if (!(buttonState === 'connecting' || buttonState === 'has-wallet')) {
            return labels['no-wallet'];
        }
        return labels[buttonState];
    }, [buttonState, children, labels, publicKey]);
    return ((0, jsx_runtime_1.jsxs)("div", { className: "wallet-adapter-dropdown", children: [(0, jsx_runtime_1.jsx)(BaseWalletConnectionButton_1.BaseWalletConnectionButton, { ...props, "aria-expanded": menuOpen, style: { pointerEvents: menuOpen ? 'none' : 'auto', ...props.style }, onClick: () => {
                    switch (buttonState) {
                        case 'no-wallet': {
                            setModalVisible(true);
                            break;
                        }
                        case 'has-wallet': {
                            if (onConnect) {
                                onConnect();
                            }
                            break;
                        }
                        case 'connected': {
                            setMenuOpen(true);
                            break;
                        }
                    }
                }, walletIcon: walletIcon, walletName: walletName, children: content }), (0, jsx_runtime_1.jsxs)("ul", { "aria-label": "dropdown-list", className: `wallet-adapter-dropdown-list ${menuOpen && 'wallet-adapter-dropdown-list-active'}`, ref: ref, role: "menu", children: [publicKey ? ((0, jsx_runtime_1.jsx)("li", { className: "wallet-adapter-dropdown-list-item", onClick: async () => {
                            await navigator.clipboard.writeText(publicKey.toBase58());
                            setCopied(true);
                            setTimeout(() => setCopied(false), 400);
                        }, role: "menuitem", children: copied ? labels['copied'] : labels['copy-address'] })) : null, (0, jsx_runtime_1.jsx)("li", { className: "wallet-adapter-dropdown-list-item", onClick: () => {
                            setModalVisible(true);
                            setMenuOpen(false);
                        }, role: "menuitem", children: labels['change-wallet'] }), onDisconnect ? ((0, jsx_runtime_1.jsx)("li", { className: "wallet-adapter-dropdown-list-item", onClick: () => {
                            onDisconnect();
                            setMenuOpen(false);
                        }, role: "menuitem", children: labels['disconnect'] })) : null] })] }));
}
